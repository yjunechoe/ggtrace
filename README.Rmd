---
title: "ggtrace"
output:
  md_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
ragg_png = function(...) {
  ragg::agg_png(..., res = 300, units = "in")
}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5,
  dev = "ragg_png",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# **{ggtrace}** <img class="logo" src="man/figures/logo.png" align="right" style="width:120px;" />

#### **Programmatically explore, debug, and manipulate ggplot internals**

<!-- badges: start -->
[![](https://img.shields.io/badge/devel%20version-0.5.2-gogreen.svg)](https://github.com/yjunechoe/ggtrace)
<!-- badges: end -->

![](https://i.imgur.com/kpTffyw.jpg)

### **Installation**

You can install the development version from [GitHub](https://github.com/yjunechoe/ggtrace/) with:

``` r
# install.packages("remotes")
remotes::install_github("yjunechoe/ggtrace")
```

```{r setup}
library(ggtrace) # v0.5.2
```

More on the ðŸ“¦ package website: [https://yjunechoe.github.io/ggtrace](https://yjunechoe.github.io/ggtrace)

### **Description**

`{ggtrace}` embodies an opinionated approach to learning about ggplot internals. The internals is a difficult topic, so I recommend watching the following presentations on `{ggtrace}` before getting started on any kind of code:

- [Presentation at rstudio::conf(2022)](https://www.rstudio.com/conference/2022/talks/cracking-open-ggplot-internals-ggtrace/)

- [Presentation at useR! 2022](https://www.youtube.com/watch?v=2JX8zu4QxMg&t=2959s)

Read more about the philosophy behind `{ggtrace}` in the [Getting Started](https://yjunechoe.github.io/ggtrace/articles/getting-started.html) vignette, and see examples in the [Overview](https://yjunechoe.github.io/ggtrace/articles/overview.html) vignette.

### **Example usage**

#### **Clipped polar coordinates**

Plot in polar coordinates:

```{r polar-plot, message = FALSE}
library(ggplot2) # v3.3.6

polar_plot <- ggplot(mtcars, aes(hp, mpg)) +
  geom_point() +
  geom_smooth(method = "lm") +
  expand_limits(y = c(0, 60)) +
  coord_polar(start = 0, theta = "y")

polar_plot
```

Clipping the plot panel with `{ggtrace}` by highjacking the `Layout$render()` method:

```{r polar-plot-clipped}
ggtrace::with_ggtrace(
  x = polar_plot + theme(aspect.ratio = 1/.48),
  method = Layout$render,
  trace_steps = 5L,
  trace_expr = quote({
    panels[[1]] <- editGrob(panels[[1]], vp = viewport(xscale = c(0.48, 1)))
  }),
  out = "g"
)
```

#### **Highlighting a stacked bar**

```{r}
stacked_barplot <- ggplot(mpg, aes(factor(drv), fill = factor(cyl))) +
  geom_bar(position = position_fill()) +
  geom_label(
    aes(label = paste("n =", after_stat(count)), group = factor(cyl)),
    fill = "white",
    stat = StatCount,
    position = position_fill(vjust = 0.5)
  ) +
  scale_y_continuous(labels = scales::label_percent()) +
  facet_wrap(~ year)
```

```{r}

stacked_barplot
```


