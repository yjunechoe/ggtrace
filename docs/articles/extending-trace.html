<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extending trace() • ggtrace</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Atkinson_Hyperlegible-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Extending trace()">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggtrace</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="external-link nav-link" href="https://yjunechoe.github.io/static/papers/Choe_2022_SublayerGG.pdf">Paper</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Usage</h6></li>
    <li><a class="dropdown-item" href="../articles/examples-gallery.html">Examples gallery</a></li>
    <li><a class="dropdown-item" href="../articles/workflow-functions.html">Workflow functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Design</h6></li>
    <li><a class="dropdown-item" href="../articles/pedagogical-philosophy.html">Pedagogical Philosophy</a></li>
    <li><a class="dropdown-item" href="../articles/extending-trace.html">Extending trace()</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">Frequently asked questions</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yjunechoe/ggtrace/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extending trace()</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yjunechoe/ggtrace/blob/HEAD/vignettes/extending-trace.Rmd" class="external-link"><code>vignettes/extending-trace.Rmd</code></a></small>
      <div class="d-none name"><code>extending-trace.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yjunechoe.github.io/ggtrace">ggtrace</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="extending-basetrace-with-ggtrace">
<strong>Extending <code>base::trace()</code> with
<code>ggtrace()</code></strong><a class="anchor" aria-label="anchor" href="#extending-basetrace-with-ggtrace"></a>
</h2>
<p>The low-level function <code><a href="../reference/ggtrace.html">ggtrace()</a></code> is designed for
interacting with functions and ggproto methods in the
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> ecosystem, from the “outside”.</p>
<p>Formally put, <code><a href="../reference/ggtrace.html">ggtrace()</a></code> allows the user to inject
arbitrary expressions (called <strong>traces</strong>) to functions and
methods that are evaluated over the execution of a ggplot. When
“triggered” by the evaluation of the ggplot, these traces may modify the
resulting graphical output, or they may simply log their values to the
“tracedump” for further inspection by the user. Check out the <a href="https://yjunechoe.github.io/ggtrace/articles/FAQ.html">FAQ
vignette</a> for more details.</p>
<p>Briefly, there are three key arguments to <code><a href="../reference/ggtrace.html">ggtrace()</a></code>:</p>
<ul>
<li>
<code>method</code>: what function/method to trace</li>
<li>
<code>trace_steps</code>: where in the body to inject
expressions</li>
<li>
<code>trace_exprs</code> what expressions to inject</li>
</ul>
<p>A simple example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dummy_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">y</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">dummy_fn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>The following code injects the code <code>z &lt;- z * 10</code> right
as <code>dummy_fn</code> enters the third “step” in the body, <em>right
before</em> the line <code>return(z)</code> is ran.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">dummy_fn</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; return(z)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggtrace.html">ggtrace</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="va">dummy_fn</span>,</span>
<span>  trace_steps <span class="op">=</span> <span class="fl">3L</span>, <span class="co"># Before `return(z)` is ran</span></span>
<span>  trace_exprs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">z</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; `dummy_fn` now being traced.</span></span></code></pre></div>
<p>Note that the value of <code>trace_exprs</code> must be of type
“language” (a quoted expression), the idea being that we are
<em>injecting</em> code to be evaluate inside the function when it is
called. Often, providing the code wrapped in <code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote()</a></code>
suffices. For more complex injections see the <a href="https://adv-r.hadley.nz/expressions.html" class="external-link">Expressions chapter of
Advanced R</a></p>
<p>After this <code><a href="../reference/ggtrace.html">ggtrace()</a></code> call, the next time
<code>dummy_fn</code> is called it is run with this injected code.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Returns 30 instead of 3</span></span>
<span><span class="fu">dummy_fn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Triggering trace on `dummy_fn`</span></span>
<span><span class="co">#&gt; Untracing `dummy_fn` on exit.</span></span>
<span><span class="co">#&gt; [1] 30</span></span></code></pre></div>
<p>Essentially, <code>dummy_fn</code> ran with this following modified
code just now:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dummy_fn_traced</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">y</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">z</span> <span class="op">*</span> <span class="fl">10</span> <span class="co">#&lt; injected code!</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">dummy_fn_traced</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 30</span></span></code></pre></div>
<p>By default, traces created by <a href="https://yjunechoe.github.io/ggtrace">ggtrace</a> functions delete
themselves after being triggered. You can also check whether a function
is currently being traced with <code><a href="../reference/is_traced.html">is_traced()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/is_traced.html">is_traced</a></span><span class="op">(</span><span class="va">dummy_fn</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p><a href="https://yjunechoe.github.io/ggtrace">ggtrace</a> automatically logs the output of triggered
trace to what we call <strong>tracedumps</strong>. For example,
<code><a href="../reference/last_ggtrace.html">last_ggtrace()</a></code> stores the output of the <em>last</em> trace
created by <code><a href="../reference/ggtrace.html">ggtrace()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The value of `(z &lt;- z * 10)` when it was ran</span></span>
<span><span class="fu"><a href="../reference/last_ggtrace.html">last_ggtrace</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Note that this is a list of length `trace_steps`</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 30</span></span></code></pre></div>
<p>See the references section <a href="https://yjunechoe.github.io/ggtrace/reference/index.html#extending-base-trace-"><strong>Extending
base::trace()</strong></a> for more functionalities offered by
<code><a href="../reference/ggtrace.html">ggtrace()</a></code>.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://yjunechoe.github.io" class="external-link">June Choe</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
